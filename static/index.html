<html>
<head>
    <title>Servant: counter</title>
    <style>
        body {
            text-align: center;
        }

        #inc {
            margin: 0px 20px;
            background-color: green;
            color: white;
        }
    </style>
</head>
<html>
<span id="state">State: 0</span>
<button id="inc">change</button>
<label id="label" for="field"></label>
<form id="form">
    <input name="name" id="field" type="text"/>
    <button type="submit">submit</button>
</form>

<div id="users"></div>
<label id="game" for="opname"></label>
<form id="playForm">
    <input name="opname" id="opname" type="text"/>
    <button type="play">play</button>
</form>

<script src="jquery.min.js" type="text/javascript"></script>
<script src="stateApi.js" type="text/javascript"></script>
<script src="userApi.js" type="text/javascript"></script>
<script type="text/javascript">
    // $(document).ready(function () {
    //     getState(updateState, alert);
    //
    //     window.setInterval(function () {
    //         getState(updateState, alert);
    //     }, 1000);
    // });
    var username = "";


    $(document).ready(function () {
        window.setInterval(function () {
            if (username !== "") {
                postGame(username, function f(response) {
                    console.log(response);
                    if (response.pk !== "#")
                        $('#game').text(response);
                }, alert);
            }
        }, 1000);
    });

    function updateState(response) {
        $('#state').html('state: ' + response.value);
    }

    $('#inc').click(function () {
        postState(updateState, alert);
    });

    $('#form').submit(function () {
        username = $('#field').val();
        postUser(username, function f(response) {
            console.log(response);

            var list = '';
            var arr = response.users;
            arr.forEach(function(item) {
                if (item.name !== username) {
                    list += '<li>' + item.name + '</li>';
                }
            });

            document.getElementById('users').innerHTML += '<ul>' + list + '</ul>';

            $('#label').text(username);
        }, alert);
        return false;
    });

    $('#playForm').submit(function () {
        let players = {
            firstPlayerName: $('#label').text(),
            secondPlayerName: $('#opname').val()
        };
        console.log(players);
        postPlay(players, function f(response) {
            console.log(response);
            $('#game').text(response);
        }, alert);
        return false;
    });
</script>
</body>
</html>
